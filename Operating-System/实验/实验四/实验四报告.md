# 实验四报告：磁盘调度

## 五、源程序及注释
- 源码文件：`实验四/disk_scheduling.cpp`

### 代码结构概要（按指定四列格式）

| 类别      | 名称/方法/属性                                                      | 类型 / 返回值类型  | 核心功能与说明                                                                                                                                                                                                                                                                                               |
| --------- | ------------------------------------------------------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 类        | `struct/class ElevatorScheduler`                                    | 调度器类           | 封装电梯调度（SCAN）算法，管理请求队列、当前磁头位置与移动方向，并提供请求生成、显示与调度执行接口。                                                                                                                                                                                                         |
| 字段      | `totalTracks`                                                       | `int`              | 磁盘总磁道数（例如 `200`）。                                                                                                                                                                                                                                                                                 |
| 字段      | `currentPosition`                                                   | `int`              | 当前磁头所在磁道号，作为调度参考点。                                                                                                                                                                                                                                                                         |
| 字段      | `movingUp`                                                          | `bool`             | 磁头当前移动方向：`true` 表示向磁道号增加方向，`false` 表示向减少方向。                                                                                                                                                                                                                                      |
| 字段      | `queue`                                                             | `std::vector<int>` | 请求队列，存放所有待服务的磁道号（允许重复）。                                                                                                                                                                                                                                                               |
| 方法      | `addRequest(int track)`                                             | `void`             | 向队列添加单个请求，包含合法性检查（0 <= track < totalTracks）。                                                                                                                                                                                                                                             |
| 方法      | `generateRandomRequests(int count)`                                 | `void`             | 随机生成 `count` 个磁道请求并加入队列；使用 `srand(time(0))` 初始化随机种子，`rand() % totalTracks` 生成单个请求。                                                                                                                                                                                           |
| 方法      | `displayQueue()`                                                    | `void`             | 打印当前请求序列，便于验证输入与调度前状态。                                                                                                                                                                                                                                                                 |
| 方法      | `schedule()`                                                        | `void`             | 执行电梯调度（SCAN）：             - 将请求分为 `upperRequests`（>= currentPosition）和 `lowerRequests`（< currentPosition）；     - 对 `upperRequests` 升序、`lowerRequests` 降序排序；    - 按 `movingUp` 决定先服务哪一组，依次计算每步寻道距离并累加；    - 输出每步服务记录、总寻道长度与平均寻道长度。 |
| 常量/参数 | `TOTAL_TRACKS` / `INITIAL_POSITION` / `MOVING_UP` / `REQUEST_COUNT` | `int` / `bool`     | `main()` 中设定的实验参数：磁道数、初始磁头位置、初始方向、随机请求数量（示例：200/100/true/15）。                                                                                                                                                                                                           |

```cpp
// 核心函数摘要（完整代码见实验四/disk_scheduling.cpp）
#include <vector>
#include <algorithm>

class ElevatorScheduler {
        int totalTracks, currentPosition; bool movingUp; std::vector<int> queue;
    public:
        void generateRandomRequests(int count);
        void schedule();
};
```

(文件内含更详细注释，打印时请将完整 `disk_scheduling.cpp` 一并打印并装订)

## 六、打印的程序运行时初值和运行结果

```shell
========== 磁盘调度模拟 - 电梯调度算法(SCAN) ==========
磁盘总磁道数: 200
初始磁头位置: 100 号磁道
初始移动方向: 向磁道号增加方向

磁道请求序列: 40, 46, 183, 81, 3, 62, 45, 2, 68, 50, 40, 8, 6, 79, 150

========== 电梯调度过程 ==========
初始磁头位置: 100 号磁道
初始移动方向: 向磁道号增加方向

步骤  服务磁道移动距离   当前总寻道
--------------------------------------------------
1       150         50             50
2       183         33             83
--- 到达边界，调转方向 ---
3       81          102            185
4       79          2              187
5       68          11             198
6       62          6              204
7       50          12             216
8       46          4              220
9       45          1              221
10      40          5              226
11      40          0              226
12      8           32             258
13      6           2              260
14      3           3              263
15      2           1              264

========== 调度统计 ==========
服务顺序: 150 -> 183 -> 81 -> 79 -> 68 -> 62 -> 50 -> 46 -> 45 -> 40 -> 40 -> 8 -> 6 -> 3 -> 2
总寻道长度: 264 个磁道
请求总数: 15 个
平均寻道长度: 17.60 个磁道

程序结束。
```

## 七、实验小结

- **实验目标回顾：** 本次实验实现并验证了电梯调度（SCAN）算法，目的是掌握磁盘调度策略的实现方法、评估其对寻道效率的影响，并学会统计与分析寻道长度等性能指标。
- **实现要点：** 将请求按当前磁头位置分为上（>= currentPosition）和下（< currentPosition）两组；对上组升序、下组降序排序；根据初始移动方向连续服务一侧请求，再反向服务另一侧；每次服务记录移动距离并累加以得到总寻道长度及平均寻道长度。
- **测试与结果分析：** 在本报告示例中（磁道数200、初始位置100、随机15个请求），SCAN 在连续服务同一方向请求时能减少磁头频繁来回，示例运行得到总寻道264、平均寻道约17.60；该数值受请求分布、初始位置与方向影响，通常对半径分布均衡的请求，SCAN 比 FCFS 更稳定，平均寻道长度更小。
- **优点与适用场景：** SCAN 能保证较好的吞吐稳定性，避免磁头饥饿（对远端请求不必长期等待），适用于请求分布范围广且希望响应延迟平衡的场景；实现简单且易于生成服务顺序与统计信息。
- **局限与改进方向：**
    - SCAN 在边界来回时仍会产生额外寻道开销，可改为 C-SCAN（只单向循环）以降低边界回退带来的延迟抖动。
    - 未比较其他算法（SSTF、LOOK、C-SCAN、FCFS），可通过批量测试不同分布（集中、均匀、聚集热点）来量化性能差异。
    - 当前实现使用同步、单线程模拟；实际系统可考虑并发请求处理、I/O 服务时间与优先级权重，进一步逼近真实调度情形。
- **实现细节与鲁棒性考虑：** 对输入做了合法性检查（0 ≤ track < totalTracks）；在统计时处理重复请求与空队列情形（避免除以0）；建议在复现实验时固定随机种子以便结果可复现（例如使用固定值调用 `srand(seed)`）。
- **复现实验步骤（简要）：**
    1. 编译源程序：

         ```bash
         g++ -std=c++17 实验四/disk_scheduling.cpp -o disk_scheduling
         ```

    2. 运行：

         ```bash
         ./disk_scheduling
         ```

    3. 若需复现相同请求序列，请将 `generateRandomRequests` 中的 `srand(time(0))` 改为固定种子，如 `srand(12345)`，记录并比较多次运行的统计结果。
- **个人体会：** 通过本次实验掌握了磁盘调度核心思想与实现流程，理解了不同策略在响应时间与平均寻道上的折衷关系；同时体会到写出可测、可复现的模拟程序对于性能对比实验的重要性。