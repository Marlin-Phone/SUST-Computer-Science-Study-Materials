# 网络应用程序设计 综合实验报告

题目：基于Java Web的网上蛋糕商城的设计与实现  

学生姓名：马凌峰  
学号：202307020122  
院（系）：电智学院  
专业：计算机科学与技术  
指导教师：陈景霞  
日期：2025-10-21

> 说明：本报告基于本地 CookieShop 项目实际源码与运行调试过程撰写，内容独立完成，涉及的关键代码以文件路径与方法名引用为主，避免大段复制。

---

## 1 系统简介

本系统面向普通消费者与后台管理员，提供蛋糕/糕点类商品的浏览、搜索、购物车、下单与订单管理等功能。系统采用 B/S 架构，前端以 JSP + JSTL + 原生 JS/CSS 为主，后端采用基于 Servlet 的 MVC 分层（Controller/Service/DAO），持久层以 Apache Commons-DbUtils + C3P0 连接池访问 MySQL 8.0 数据库。系统在 Tomcat 9.0 上部署运行。

主要功能：
- 前台
  - 用户注册/登录/退出
  - 首页推荐（条幅/热销/新品）
  - 商品按类目浏览、关键字搜索
  - 购物车（加入、减少、删除）
  - 下单、查看订单列表
- 后台
  - 商品管理（增删改查、推荐位设置）
  - 订单管理（查询、状态流转、删除）
  - 用户管理（查询、重置、删除）
  - 类目管理（增删改）


## 2 系统需求分析

- 用户角色
  - 游客：浏览、搜索商品
  - 注册用户：登录、购物车、下单、查看订单、维护收货信息
  - 管理员：维护类目、商品、用户，查看与处理订单

- 功能性需求（示例）
  - 支持按类目分页浏览商品，按关键字搜索商品
  - 购物车支持增减数量与删除条目
  - 订单包含总价、件数、收货信息、支付方式与状态管理
  - 首页展示轮播条幅、新品与热销推荐

- 非功能性需求
  - 兼容 MySQL 8.0；字符集采用 UTF-8/UTF-8MB4
  - 连接池复用、基本的输入编码统一（过滤器统一设置 UTF-8）
  - 可在 Tomcat 9.0 上稳定运行


## 3 数据库设计

### 3.1 数据库与实体关系

数据库：cookieshop（MySQL 8.0）。核心实体：
- type（商品类目）1—N goods
- goods（商品）N—1 type
- user（用户）1—N order
- order（订单头）1—N orderitem
- orderitem（订单明细）N—1 goods, N—1 order
- recommend（推荐）N—1 goods（记录商品所属推荐位：1条幅、2热销、3新品）

关系说明：
- goods.type_id → type.id（外键）
- order.user_id → user.id（外键）
- orderitem.goods_id → goods.id；orderitem.order_id → order.id（外键）
- recommend.goods_id → goods.id（外键，级联删除）

本项目提供两套脚本：
- 带演示数据：`CookieShop/cookieshop-mysql8.0.sql`
- 纯结构定义：`CookieShop/sql/create_schema_mysql8.sql`（本次新增，utf8mb4，含索引/约束）

### 3.2 表结构设计（节选）

- 表：type（类目）
  - id INT PK, AUTO_INCREMENT
  - name VARCHAR(45) UNIQUE, NOT NULL

- 表：goods（商品）
  - id INT PK, AUTO_INCREMENT
  - name VARCHAR(100) NOT NULL
  - cover/image1/image2 VARCHAR(255)
  - price DECIMAL(10,2) NOT NULL
  - intro VARCHAR(500)
  - stock INT NOT NULL
  - type_id INT NOT NULL → type.id

- 表：user（用户）
  - id INT PK, AUTO_INCREMENT
  - username VARCHAR(45) UNIQUE NOT NULL
  - email VARCHAR(100) UNIQUE NOT NULL
  - password VARCHAR(100) NOT NULL
  - name/phone/address 可空
  - isadmin BIT(1) DEFAULT 0
  - isvalidate BIT(1) DEFAULT 0

- 表：order（订单头）
  - id INT PK, AUTO_INCREMENT
  - total DECIMAL(12,2) NOT NULL
  - amount INT NOT NULL
  - status TINYINT NOT NULL（1未付款/2已付款/3已发货/4已完成）
  - paytype TINYINT NOT NULL（1微信/2支付宝/3货到付款）
  - name/phone/address 收货信息
  - datetime DATETIME DEFAULT CURRENT_TIMESTAMP
  - user_id INT NOT NULL → user.id

- 表：orderitem（订单明细）
  - id INT PK, AUTO_INCREMENT
  - price DECIMAL(10,2) NOT NULL
  - amount INT NOT NULL
  - goods_id INT NOT NULL → goods.id
  - order_id INT NOT NULL → order.id（删除订单级联删除明细）

- 表：recommend（推荐）
  - id INT PK, AUTO_INCREMENT
  - type TINYINT NOT NULL（1条幅/2热销/3新品）
  - goods_id INT NOT NULL → goods.id（删除商品级联删除推荐）

创建表 SQL：见 `CookieShop/sql/create_schema_mysql8.sql`。


## 4 系统设计与实现

### 4.1 项目组织结构（关键目录）

- `CookieShop/src`
  - `model/`：实体类（`Goods.java`,`Type.java`,`User.java`,`Order.java`,`OrderItem.java`,`Recommend.java`）
  - `dao/`：数据访问（`GoodsDao.java`,`TypeDao.java`,`UserDao.java`,`OrderDao.java`）
  - `service/`：业务逻辑（`GoodsService.java`,`TypeService.java`,`UserService.java`,`OrderService.java`）
  - `servlet/`：控制器（大量 @WebServlet 注解的前台与后台 Servlet）
  - `filter/`：过滤器（`EncodeFilter.java` 统一 UTF-8 编码）
  - `utils/`：工具（`DataSourceUtils.java` 提供 C3P0 数据源；`PriceUtils.java` 价格计算）
  - `c3p0-config.xml`：数据库连接池配置
- `CookieShop/web`
  - 前台 JSP：`index.jsp`,`goods_list.jsp`,`goods_detail.jsp`,`goods_cart.jsp`,`order_submit.jsp` 等
  - 用户 JSP：`user_login.jsp`,`user_register.jsp`,`user_center.jsp`
  - 后台 JSP：`/admin/*.jsp`（商品/订单/用户/类目）
  - 资源：`css/`,`js/`,`images/`,`picture/` 等
  - `WEB-INF/web.xml`：欢迎页配置（其余 Servlet 走注解映射）
  - `WEB-INF/lib`：依赖 JAR（mysql-connector、c3p0、dbutils、jstl 等）

MVC 对应关系：
- M：`model/*`
- V：`web/*.jsp` 与 `/admin/*.jsp`
- C：`src/servlet/*`（如 `GoodsListServlet`,`UserLoginServlet`,`OrderSubmitServlet` 等）

### 4.2 项目开发环境与配置

- 操作系统：Windows 10/11
- JDK：1.8+（与 Tomcat9 兼容）
- IDE：IntelliJ IDEA（已提供 `CookieShop.iml` 模块文件）
- Web 服务器：Tomcat 9.0（`webapps/CookieShop` 结构）
- 数据库：MySQL 8.0（示例使用 127.0.0.1:3306）
- 依赖：JSTL、Servlet API、C3P0、Commons-DbUtils、MySQL JDBC、Commons-Fileupload/IO 等（见 `WEB-INF/lib`）

数据库连接设置（`src/c3p0-config.xml`）：
```xml
<property name="driverClass">com.mysql.cj.jdbc.Driver</property>
<property name="jdbcUrl">jdbc:mysql://localhost:3306/cookieshop?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</property>
<property name="user">root</property>
<property name="password">1234</property>
```
如本机端口、账号不同，请修改上述配置并确保 `mysql-connector-java-8.x.x.jar` 在 `WEB-INF/lib`。

在 IDEA 中导入与调试步骤：
1) File → New → Project from Existing Sources... → 选择 `CookieShop` 目录（识别为 IntelliJ Module）
2) Project Structure → Project SDK 选择 JDK 1.8+；Language level 8
3) 添加 Tomcat 9：Run/Debug Configurations → + → Tomcat Server → Local
   - Deployment：添加 Artifact（若是 exploded 目录：指向 `CookieShop/web` 或已配置的 Web Artifact）
   - Application context：`/CookieShop`（或根 `/`）
4) 创建数据库并导入脚本（任选其一）：
   - 仅结构：`CookieShop/sql/create_schema_mysql8.sql`
   - 结构+演示数据：`CookieShop/cookieshop-mysql8.0.sql`
5) 启动调试，访问：
   - 首页：http://localhost:8080/CookieShop/index
   - 管理后台：http://localhost:8080/CookieShop/admin/index.jsp （管理员初始账号见脚本 `user` 表）

### 4.3 系统功能实现

总体模块划分（前/后台）：
- 前台：用户、类目与商品、推荐、搜索、购物车、订单
- 后台：商品、订单、用户、类目维护

#### 4.3.1 前端模块实现

以“控制器 → 业务 → DAO → JSP”的链路说明：

1) 用户注册
- 控制器：`servlet/UserRegisterServlet.java`
- 业务：`service/UserService.register(User)`
- DAO：`dao/UserDao.addUser(User)`（唯一性校验 `isUsernameExist`、`isEmailExist`）
- 视图：`web/user_register.jsp`

2) 用户登录
- 控制器：`servlet/UserLoginServlet.java`
- 业务：`service/UserService.login(ue, password)`（支持用户名或邮箱登录）
- DAO：`dao/UserDao.selectByUsernamePassword / selectByEmailPassword`
- 视图：`web/user_login.jsp`，登录后跳转用户中心或来源页

3) 购物车
- 控制器：
  - `servlet/GoodsBuyServlet.java`（加入）
  - `servlet/GoodsLessenServlet.java`（减少）
  - `servlet/GoodsDeleteServlet.java`（删除）
- 业务/模型：`model/Order` 以内存结构维护 `itemMap` 与汇总逻辑（`addGoods/lessen/delete`，`PriceUtils` 做加减）
- DAO：查商品信息 `dao/GoodsDao.getGoodsById`
- 视图：`web/goods_cart.jsp`

4) 商品分类查询
- 控制器：`servlet/GoodsListServlet.java`
- 业务：`service/GoodsService.selectPageByTypeID(int typeId,int pageNumber)`
- DAO：`dao/GoodsDao.selectGoodsByTypeID / getCountOfGoodsByTypeID`
- 视图：`web/goods_list.jsp`（配合 `web/page.jsp` 分页组件）

5) 商品搜索
- 控制器：`servlet/GoodsSearchServlet.java`
- 业务：`service/GoodsService.getSearchGoodsPage(keyword, pageNumber)`
- DAO：`dao/GoodsDao.selectSearchGoods / getSearchCount`
- 视图：`web/goods_search.jsp`

首页推荐：
- 控制器：`servlet/IndexServlet.java`（`/index`）
- 业务：`service/GoodsService.getScrollGood()` 与 `getGoodsList(type)`
- DAO：`dao/GoodsDao.getScrollGood / getGoodsList`
- 视图：`web/index.jsp`

#### 4.3.2 后台模块实现

1) 商品管理
- 控制器：`servlet/AdminGoodsListServlet.java / AdminGoodsAddServlet.java / AdminGoodsEditServlet.java / AdminGoodsDeleteServlet.java / AdminGoodsRecommendServlet.java`
- 业务：`service/GoodsService.*`（`insert/update/delete` 与 `addRecommend/removeRecommend`）
- DAO：`dao/GoodsDao.*`
- 视图：`web/admin/goods_list.jsp / goods_add.jsp / goods_edit.jsp`

2) 订单管理
- 控制器：`servlet/AdminOrderListServlet.java / AdminOrderStatusServlet.java / AdminOrderDeleteServlet.java`
- 业务：`service/OrderService.getOrderPage/updateStatus/delete`
- DAO：`dao/OrderDao.*`
- 视图：`web/admin/order_list.jsp`

3) 客户管理
- 控制器：`servlet/AdminUserListServlet.java / AdminUserEditServlet.java / AdminUserResetServlet.java / AdminUserDeleteServlet.java / AdminUserAddServlet.java`
- 业务：`service/UserService.getUserPage/delete/updatePwd/updateUserAddress`
- DAO：`dao/UserDao.*`
- 视图：`web/admin/user_list.jsp / user_edit.jsp / user_add.jsp / user_reset.jsp`

4) 类目管理
- 控制器：`servlet/AdminTypeListServlet.java / AdminTypeAddServlet.java / AdminTypeEditServlet.java / AdminTypeDeleteServlet.java`
- 业务：`service/TypeService.*`
- DAO：`dao/TypeDao.*`
- 视图：`web/admin/type_list.jsp / type_edit.jsp`

编码与过滤：
- `filter/EncodeFilter.java` 全局设置 `req.setCharacterEncoding("utf-8")`，避免中文参数乱码。

事务与一致性：
- 下单：`service/OrderService.addOrder` 手动事务（`Connection#setAutoCommit(false)`），先插入 `order`，取 `last_insert_id()`，再插入 `orderitem`，失败回滚。
- 删除订单：先删 `orderitem` 再删 `order`，或依赖外键 `ON DELETE CASCADE`。


## 5 总结

本次课程设计完成了一个基于原生 Servlet/JSP 的电商小系统，梳理了 MVC 分层的职责划分：
- Servlet 专注于接收请求/组装参数/分发视图
- Service 负责业务编排与事务
- DAO 专注 SQL 与数据映射
- Model 承载领域数据

难点与收获：
- MySQL 8.0 下外键/字符集/时间类型的兼容与规范化（统一 UTF-8MB4、补充索引、精确的 DECIMAL 金额类型）
- 使用连接池与 DbUtils 简化访问代码，提升可维护性
- 通过注解 `@WebServlet` 减少 `web.xml` 配置量

可改进点：
- 增加登录校验与权限过滤（如后台 `AdminFilter` 更细粒度控制）
- 表单与参数校验、XSS/CSRF 防护
- 引入框架（如 Spring MVC/Spring Boot + MyBatis/JPA），提高可测试性与扩展性
- 文件上传与图片存储优化（对象存储/静态资源服务）


## 6 参考文献

[1] 李刚. 疯狂Java讲义[M]. 北京: 电子工业出版社, 2019.
[2] MySQL 8.0 Reference Manual[EB/OL]. https://dev.mysql.com/doc/refman/8.0/en/
[3] Servlet 4.0 Specification[EB/OL]. https://jakarta.ee/specifications/servlet/4.0/
[4] Apache Tomcat 9 Documentation[EB/OL]. https://tomcat.apache.org/tomcat-9.0-doc/
[5] Commons DbUtils User Guide[EB/OL]. https://commons.apache.org/proper/commons-dbutils/
